<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Try-On Results - Virtual Try-On Lab</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <header class="header results-header">
            <h1>Virtual Try-On Results</h1>
            <p>Swipe through your amazing transformations</p>
        </header>

        <!-- Results Summary -->
        <section class="results-summary">
            <div class="summary-stats">
                <div class="stat-item">
                    <span class="stat-number">{{ results.completed_items }}</span>
                    <span class="stat-label">Successful</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ results.failed_items }}</span>
                    <span class="stat-label">Failed</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ "%.1f"|format(results.duration) }}s</span>
                    <span class="stat-label">Processing Time</span>
                </div>
            </div>
        </section>

        <!-- Results Carousel -->
        <section class="results-carousel-section">
            <div class="results-carousel-container">
                <!-- Carousel Navigation -->
                <button class="carousel-nav carousel-nav-prev" id="carouselPrev" aria-label="Previous result">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
                <button class="carousel-nav carousel-nav-next" id="carouselNext" aria-label="Next result">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>

                <!-- Carousel Track -->
                <div class="results-carousel-track-container">
                    <div class="results-carousel-track" id="resultsCarouselTrack">
                        <!-- Original Photo Slide -->
                        <div class="carousel-result-slide original-slide">
                            <div class="slide-content">
                                <div class="slide-label">Original Photo</div>
                                <div class="slide-image-container">
                                    <img src="{{ url_for('serve_upload', filename=user_image) }}" 
                                         alt="Your original photo" 
                                         class="slide-image original-image">
                                </div>
                                <div class="slide-info">
                                    <h3>Your Starting Point</h3>
                                    <p>Swipe to see your virtual try-ons</p>
                                </div>
                            </div>
                        </div>

                        <!-- Result Slides -->
                        {% for result in results.results %}
                        <div class="carousel-result-slide" data-result-index="{{ loop.index0 }}">
                            <div class="slide-content">
                                <div class="slide-label">Item {{ result.clothing_item.name }}</div>
                                <div class="slide-image-container">
                                    <img src="{{ url_for('serve_result', filename=result.result_filename) }}" 
                                         alt="Try-on result for {{ result.clothing_item.name }}" 
                                         class="slide-image result-image"
                                         data-filename="{{ result.result_filename }}"
                                         data-item-name="{{ result.clothing_item.name }}">
                                    <div class="slide-actions">
                                        <button class="btn-slide-action btn-fullscreen" 
                                                onclick="viewFullResult('{{ result.result_filename }}', '{{ result.clothing_item.name }}')"
                                                aria-label="View fullscreen">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                                            </svg>
                                        </button>
                                        <button class="btn-slide-action btn-download" 
                                                onclick="downloadResult('{{ result.result_filename }}', '{{ result.clothing_item.name }}')"
                                                aria-label="Download">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="slide-info">
                                    <h3>Item {{ result.clothing_item.name }}</h3>
                                    <p class="slide-status success">✓ Successfully generated</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}

                        <!-- Failed Results -->
                        {% for error in results.errors %}
                        <div class="carousel-result-slide error-slide">
                            <div class="slide-content">
                                <div class="slide-label error">Failed - Item {{ error.clothing_item.name }}</div>
                                <div class="slide-image-container error-container">
                                    <img src="{{ url_for('serve_clothing', filename=error.clothing_item.filename) }}" 
                                         alt="Original clothing item {{ error.clothing_item.name }}" 
                                         class="slide-image grayscale">
                                    <div class="error-overlay">
                                        <span class="error-icon">⚠️</span>
                                        <p class="error-message">{{ error.error }}</p>
                                    </div>
                                </div>
                                <div class="slide-info">
                                    <h3>Item {{ error.clothing_item.name }}</h3>
                                    <p class="slide-status error">✗ Generation failed</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Carousel Indicators -->
                <div class="carousel-indicators" id="carouselIndicators">
                    <!-- Indicators will be generated by JavaScript -->
                </div>
            </div>

            <!-- Mini Grid View Toggle -->
            <div class="view-toggle">
                <button class="btn-view-toggle active" data-view="carousel" onclick="setViewMode('carousel')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="4" width="12" height="16" rx="2"/>
                    </svg>
                    Carousel
                </button>
                <button class="btn-view-toggle" data-view="grid" onclick="setViewMode('grid')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                    </svg>
                    Grid
                </button>
            </div>
        </section>

        <!-- Grid View (Hidden by default) -->
        <section class="results-grid-section" style="display: none;">
            <div class="results-grid">
                {% for result in results.results %}
                <div class="result-card">
                    <div class="result-image-container">
                        <img src="{{ url_for('serve_result', filename=result.result_filename) }}" 
                             alt="Try-on result for {{ result.clothing_item.name }}" 
                             class="result-image">
                        <div class="result-overlay">
                            <button class="btn btn-view" onclick="viewFullResult('{{ result.result_filename }}', '{{ result.clothing_item.name }}')">
                                View Full Size
                            </button>
                            <button class="btn btn-download" onclick="downloadResult('{{ result.result_filename }}', '{{ result.clothing_item.name }}')">
                                Download
                            </button>
                        </div>
                    </div>
                    <div class="result-info">
                        <h4>Item {{ result.clothing_item.name }}</h4>
                        <p class="result-status success">✓ Success</p>
                    </div>
                </div>
                {% endfor %}

                <!-- Failed Results -->
                {% for error in results.errors %}
                <div class="result-card error-card">
                    <div class="result-image-container">
                        <img src="{{ url_for('serve_clothing', filename=error.clothing_item.filename) }}" 
                             alt="Original clothing item {{ error.clothing_item.name }}" 
                             class="result-image grayscale">
                        <div class="error-overlay">
                            <span class="error-icon">⚠️</span>
                            <p class="error-message">{{ error.error }}</p>
                        </div>
                    </div>
                    <div class="result-info">
                        <h4>Item {{ error.clothing_item.name }}</h4>
                        <p class="result-status error">✗ Failed</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Actions -->
        <section class="results-actions">
            <div class="action-buttons">
                <button class="btn btn-primary btn-large" onclick="downloadAllResults()">
                    <span class="btn-icon">💾</span>
                    Download All Results
                </button>
                <button class="btn btn-secondary btn-large" onclick="window.location.href='/'">
                    <span class="btn-icon">🔄</span>
                    Try Again
                </button>
            </div>
        </section>
    </div>

    <!-- Full Size Modal -->
    <div class="modal" id="fullSizeModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Full Size Result</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-comparison">
                    <div class="modal-image-container">
                        <h4>Original</h4>
                        <img src="{{ url_for('serve_upload', filename=user_image) }}" 
                             alt="Original photo" class="modal-image">
                    </div>
                    <div class="modal-image-container">
                        <h4>Try-On Result</h4>
                        <img id="modalResultImage" alt="Try-on result" class="modal-image">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="modalDownloadBtn">Download Result</button>
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Processing...</p>
    </div>

    <script src="{{ url_for('static', filename='js/results.js') }}"></script>
</body>
</html>
