<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Try-On Lab</title>
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-enhancements.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Virtual Try-On Lab</h1>
            <p>Try on clothes virtually using AI technology</p>
        </header>

        <!-- Upload Component -->
        <section class="upload-component" id="uploadComponent">
            <div class="upload-header">
                <h3><span class="upload-icon">üì∏</span> Upload Your Photo</h3>
            </div>

            <!-- Upload Method Selection -->
            <div class="upload-method-selection">
                <div class="btn-group w-100" role="group" id="uploadMethodTabs">
                    <input type="radio" class="btn-check" name="uploadMethod" id="uploadFile" checked>
                    <label class="btn btn-outline-primary" for="uploadFile">
                        <span class="tab-icon">‚¨ÜÔ∏è</span> Upload Photo
                    </label>
                    
                    <input type="radio" class="btn-check" name="uploadMethod" id="takePhoto">
                    <label class="btn btn-outline-primary" for="takePhoto">
                        <span class="tab-icon">üì∏</span> Take Photo
                    </label>
                </div>
            </div>

            <!-- File Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div id="uploadContent">
                    <div class="upload-icon">‚òÅÔ∏è</div>
                    <h3>Drag and drop an image here</h3>
                    <p>or click to select a file</p>
                    <button type="button" class="btn btn-primary" id="browseBtn">
                        <span class="btn-icon">üìÅ</span> Choose Photo
                    </button>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    <span class="upload-tips">Supported formats: JPG, PNG</span>
                </div>
                
                <div id="uploadProgress" style="display: none;">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBar"></div>
                        </div>
                        <p>Uploading...</p>
                    </div>
                </div>
            </div>

            <!-- Camera Interface -->
            <div class="camera-area" id="cameraArea" style="display: none;">
                <div id="cameraContent">
                    <div class="camera-preview-container">
                        <video id="cameraPreview" autoplay playsinline muted></video>
                        <canvas id="captureCanvas" style="display: none;"></canvas>
                    </div>
                    
                    <div class="camera-controls">
                        <button type="button" class="btn btn-primary btn-lg" id="captureBtn">
                            <span class="btn-icon">üì∏</span> Capture Photo
                        </button>
                        <button type="button" class="btn btn-secondary" id="switchCameraBtn">
                            <span class="btn-icon">üîÑ</span> Switch Camera
                        </button>
                        <button type="button" class="btn btn-secondary" id="stopCameraBtn">
                            <span class="btn-icon">‚úñÔ∏è</span> Stop Camera
                        </button>
                    </div>
                    
                    <div class="camera-tips">
                        <small>
                            <span class="btn-icon">üí°</span>
                            <strong>Tips:</strong> Use natural lighting, step back to capture full body
                        </small>
                    </div>
                </div>
                
                <div id="cameraError" style="display: none;">
                    <div class="error-message">
                        <span class="btn-icon">‚ö†Ô∏è</span>
                        <span id="cameraErrorMessage">Camera access denied or not available</span>
                    </div>
                    <div class="error-actions">
                        <button type="button" class="btn btn-outline-primary" id="retryCameraBtn">
                            <span class="btn-icon">üîÑ</span> Try Again
                        </button>
                    </div>
                </div>
            </div>

            <!-- Captured Photo Preview -->
            <div id="capturedPhotoPreview" style="display: none;">
                <h4>Captured Photo:</h4>
                <img id="capturedImg" class="preview-image" style="max-height: 300px;">
                <div class="captured-actions">
                    <button type="button" class="btn btn-primary" id="useCapturedBtn">
                        <span class="btn-icon">‚úÖ</span> Use This Photo
                    </button>
                    <button type="button" class="btn btn-secondary" id="retakeBtn">
                        <span class="btn-icon">üîÑ</span> Retake
                    </button>
                </div>
            </div>

            <!-- Image Preview -->
            <div id="imagePreview" style="display: none;">
                <h4>Uploaded Image:</h4>
                <img id="previewImg" class="preview-image" style="max-height: 300px;">
                <div class="preview-actions">
                    <button type="button" class="btn btn-primary btn-lg" id="analyzeBtn">
                        <span class="btn-icon">üîç</span> Start Try-On
                    </button>
                </div>
            </div>
        </section>

        <!-- User Image Preview -->
        <div class="user-image-preview" id="userImagePreview" style="display: none;">
            <img id="userImage" alt="Your photo">
            <div class="image-actions">
                <button class="btn btn-secondary" id="changeImageBtn">Change Photo</button>
            </div>
        </div>

        <!-- Clothing Gallery -->
        <section class="clothing-gallery" id="clothingGallery">
            <h2>Choose Your Style</h2>
            
            <!-- Swiper Carousel Container -->
            <div class="clothing-carousel">
                <div class="swiper" id="clothingSwiper">
                    <!-- Carousel Navigation -->
                    <button class="carousel-nav carousel-nav-prev swiper-button-prev" aria-label="Previous items">
                        <span>‚Äπ</span>
                    </button>
                    <button class="carousel-nav carousel-nav-next swiper-button-next" aria-label="Next items">
                        <span>‚Ä∫</span>
                    </button>
                    
                    <!-- Swiper wrapper -->
                    <div class="swiper-wrapper">
                        {% for item in clothing_items %}
                        <div class="swiper-slide clothing-item" data-filename="{{ item.filename }}">
                            <div class="clothing-image">
                                <img src="{{ url_for('serve_clothing', filename=item.filename) }}" 
                                     alt="Clothing Item {{ item.name }}" loading="lazy">
                                <div class="clothing-overlay">
                                    <button class="btn btn-try-on">Try On</button>
                                </div>
                            </div>
                            <div class="clothing-info">
                                <h4>Item {{ item.name }}</h4>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Pagination/Indicators -->
                    <div class="swiper-pagination"></div>
                    
                    <!-- Scrollbar -->
                    <div class="swiper-scrollbar"></div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons" id="actionButtons" style="display: none;">
                <button class="btn btn-primary btn-large" id="tryAllBtn">
                    <span class="btn-icon">‚ú®</span>
                    Try All Clothes
                </button>
                <button class="btn btn-secondary btn-large" id="trySelectedBtn" style="display: none;">
                    <span class="btn-icon">üëï</span>
                    Try Selected Item
                </button>
            </div>
        </section>

        <!-- Progress Section -->
        <section class="progress-section" id="progressSection" style="display: none;">
            <div class="progress-container">
                <h3 id="progressTitle">Processing Your Try-On...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">Starting...</p>
                <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
            </div>
        </section>

        <!-- Single Result Section -->
        <section class="result-section" id="resultSection" style="display: none;">
            <h2>Your Virtual Try-On Result</h2>
            <div class="result-container">
                <div class="result-comparison">
                    <div class="result-item">
                        <h4>Original</h4>
                        <img id="originalImage" alt="Original photo">
                    </div>
                    <div class="result-item">
                        <h4>Try-On Result</h4>
                        <img id="resultImage" alt="Try-on result">
                    </div>
                </div>
                <div class="result-actions">
                    <button class="btn btn-primary" id="downloadBtn">Download Result</button>
                    <button class="btn btn-secondary" id="tryAnotherBtn">Try Another Item</button>
                    <button class="btn btn-secondary" id="startOverBtn">Start Over</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mobile-enhancements.js') }}"></script>
</body>
</html>
